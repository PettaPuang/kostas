// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  // Optimasi untuk Vercel: gunakan binary yang lebih kecil
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // Connection pooling untuk Vercel (jika menggunakan connection pooler)
  // Vercel Postgres otomatis menggunakan connection pooling
  // Jika menggunakan Prisma Accelerate, gunakan prisma+postgres:// protocol
}


// =======================================================
// ENUMS
// =======================================================

enum Role {
  DEVELOPER
  OWNER
  OWNERGROUP
  STAFF
  FINANCE
}

enum PropertyStatus {
  ACTIVE
  INACTIVE
}

enum RoomStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
}

// =======================================================
// USER & OWNER
// =======================================================

model Owner {
  id        String   @id @default(cuid())
  name      String

  users     User[]
  properties Property[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      Role

  ownerId   String?
  owner     Owner?   @relation(fields: [ownerId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// =======================================================
// PROPERTY & ROOM
// =======================================================

model Property {
  id        String @id @default(cuid())
  ownerId   String
  owner     Owner  @relation(fields: [ownerId], references: [id])

  name      String
  address   String

  latitude  Float?
  longitude Float?

  status    PropertyStatus @default(ACTIVE)

  rooms     Room[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Room {
  id         String @id @default(cuid())
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id])

  code       String
  price      Int
  status     RoomStatus @default(AVAILABLE)

  facilities RoomFacility[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([propertyId, code])
}

// =======================================================
// FACILITY (GLOBAL)
// =======================================================

model Facility {
  id   String @id @default(cuid())
  name String @unique

  rooms RoomFacility[]
}

model RoomFacility {
  roomId     String
  facilityId String

  room       Room     @relation(fields: [roomId], references: [id])
  facility   Facility @relation(fields: [facilityId], references: [id])

  @@id([roomId, facilityId])
}
